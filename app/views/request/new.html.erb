<h1 class="h3"><%= @document.first("title_tsim") %></h1>

<%- if @met_request_limit %>
  <div class="alert alert-danger" role="alert">
    <%= t("requesting.request_limit_error", url: ENV["ASK_LIBRARIAN_URL"]).html_safe %>
  </div>
<%- end %>
<%- unless @met_request_limit %>
<div class="row mt-4 mb-4">
  <% if @request_form == "manuscripts" %>
    <p class="col-12 col-lg-8"><%= t("requesting.multi_box_prompt").html_safe %></p>
    <p class="col-12 col-lg-8"><%= t("requesting.multi_box_prompt_2", finding_aid: @finding_aids_link, contact_us: Rails.application.config_for(:catalogue).contact_us_url).html_safe %></p>
  <% elsif @request_form == "serials" %>
    <p class="col-12 col-lg-8"><%= t("requesting.prompt") %></p>
  <% elsif @request_form == "maps" %>
    <p class="col-12 col-lg-8"><%= t("requesting.map_prompt").html_safe %></p>
  <% end %>
</div>
<section id="request-details">
  <div class="row">
    <div class="col-12 col-lg-8">
      <dl class="document-metadata row mb-0">
        <% if @request.item["pickupLocation"].present? %>
          <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.collect_from") %></dt>
          <dd class="col col-md-9"><%= @request.item["effectiveLocationDisplayName"] %></dd>
        <% end %>

        <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.call_number") %></dt>
        <dd class="col col-md-9">
          <p class="mb-0"><%= @request.item["effectiveCallNumberComponents"]["callNumber"] %>
            <% if @request.item["itemCategory"] == "monograph" && @request.item["enumeration"].present? %>
              <br>Copy: <%= @request.item["enumeration"] %>
            <% end %></p>
        </dd>

        <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.status") %></dt>
        <dd class="col col-md-9"><%= @request.item["status"]["name"] %></dd>

        <% if recent_item_issue_held(@request.holding).present? %>
          <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.recent_items") %></dt>
          <dd class="col col-md-9">
            <ul class="list-unstyled">
              <% recent_item_issue_held(@request.holding).each do |statement| %>
                <li><%= statement %></li>
              <% end %>
            </ul>
          </dd>
        <% end %>

        <% if items_issues_held(@request.holding).present? %>
          <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.items_held") %></dt>
          <dd class="col col-md-9">
            <ul class="list-unstyled">
              <% items_issues_held(@request.holding).each do |statement| %>
                <% statement.each do |issue| %>
                  <li><%= issue %></li>
                <% end %>
              <% end %>
            </ul>
          </dd>
        <% end %>

        <% if supplements(@request.holding).present? %>
          <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.supplements") %></dt>
          <dd class="col col-md-9">
            <ul class="list-unstyled">
              <% supplements(@request.holding).each do |statement| %>
                <% statement.each do |supplement| %>
                  <li><%= supplement %></li>
                <% end %>
              <% end %>
            </ul>
          </dd>
        <% end %>

        <% if indexes(@request.holding).present? %>
          <dt class="col-12 col-md-3 text-md-right"><%= t("requesting.metadata.indexes") %></dt>
          <dd class="col col-md-9">
            <ul class="list-unstyled">
              <% indexes(@request.holding).each do |statement| %>
                <% statement.each do |index| %>
                  <li><%= index %></li>
                <% end %>
              <% end %>
            </ul>
          </dd>
        <% end %>
      </dl>
    </div>
  </div>

<%= render "#{@request_form}_form", request: @request %>
</section>
<%- end %>
